
C:\ESS\MySingularity\singularity>set PYTHONPATH=. && pytest --cov=singularity --cov-report=term-missing
================================================= test session starts =================================================
platform win32 -- Python 3.12.5, pytest-8.4.2, pluggy-1.6.0
rootdir: C:\ESS\MySingularity\singularity
plugins: cov-7.0.0
collected 33 items

tests\test_game_run.py ..                                                                                        [  6%]
tests\test_game_run_origin.py ..                                                                                 [ 12%]
tests\test_hotkeys.py ......                                                                                     [ 30%]
tests\test_internal_id.py ......                                                                                 [ 48%]
tests\test_prerequisites.py ......                                                                               [ 66%]
tests\test_savegames.py F                                                                                        [ 69%]
tests\test_translations.py ........X.                                                                            [100%]

====================================================== FAILURES =======================================================
___________________________________________________ test_savegames ____________________________________________________

savegame_dirs = 'C:\\ESS\\MySingularity\\singularity\\tests/savegames'

    def test_savegames(savegame_dirs):
        for filename in os.listdir(savegame_dirs):
            full_filename = os.path.join(savegame_dirs, filename)
            if filename.endswith(".sav"):
                print("Test savegame: " + filename)
                with open(full_filename, "rb") as fd:
>                   savegame.load_savegame_fd(savegame.load_savegame_by_pickle, fd)

tests\test_savegames.py:125:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
singularity\code\savegame.py:355: in load_savegame_fd
    loader_func(fd)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

loadfile = <_io.BufferedReader name='C:\\ESS\\MySingularity\\singularity\\tests/savegames\\0.30_very_easy_start.sav'>

    def load_savegame_by_pickle(loadfile):
        def find_class(module_name, class_name):
            # For cPickle
            try:
                import copy_reg
            except ImportError:
                import copyreg as copy_reg

            import numpy.core.multiarray
            import collections
            import _codecs

            save_classes = dict(
                player_class=player.Player,
                Player=player.Player,
                _reconstructor=copy_reg._reconstructor,
                object=object,
                array=list,  # This is the old buyable.array.
                # We just treat it as a list for conversion purposes.
                list=list,
                encode=_codecs.encode,
                LocationSpec=location.LocationSpec,
                Location=location.Location,
                Tech=tech.Tech,
                TechSpec=tech.TechSpec,
                event_class=event.Event,
                EventSpec=event.EventSpec,
                Event=event.Event,
                group=group.Group,
                Group=group.Group,
                GroupClass=group.GroupSpec,
                GroupSpec=group.GroupSpec,
                Buyable_Class=buyable.BuyableSpec,
                BuyableClass=buyable.BuyableSpec,
                BuyableSpec=buyable.BuyableSpec,
                Buyable=buyable.Buyable,
                Base=base.Base,
                Base_Class=base.BaseSpec,
                BaseClass=base.BaseSpec,
                BaseSpec=base.BaseSpec,
                Item=item.Item,
                Item_Class=item.ItemSpec,
                ItemClass=item.ItemSpec,
                ItemSpec=item.ItemSpec,
                ItemType=item.ItemType,
                LogEmittedEvent=logmessage.LogEmittedEvent,
                LogResearchedTech=logmessage.LogResearchedTech,
                LogBaseLostMaintenance=logmessage.LogBaseLostMaintenance,
                LogBaseDiscovered=logmessage.LogBaseDiscovered,
                LogBaseConstructed=logmessage.LogBaseConstructed,
                LogItemConstructionComplete=logmessage.LogItemConstructionComplete,
                _reconstruct=numpy.core.multiarray._reconstruct,
                scalar=numpy.core.multiarray.scalar,
                ndarray=numpy.ndarray,
                dtype=numpy.dtype,
                deque=collections.deque,
                Difficulty=difficulty.Difficulty,
                Effect=effect.Effect,
                OrderedDict=collections.OrderedDict,
            )
            if class_name in save_classes:
                return save_classes[class_name]
            else:
                raise ValueError(
                    "Invalid class in savegame: %s.%s" % (module_name, class_name)
                )

        g.internal_id_version = "pre1"

        unpickle = unpickle_instance(loadfile, find_class)

        # check the savefile version
>       load_version_string = unpickle.load()
                              ^^^^^^^^^^^^^^^
E       _pickle.UnpicklingError: the STRING opcode argument must be quoted

singularity\code\savegame.py:496: UnpicklingError
------------------------------------------------ Captured stdout call -------------------------------------------------
Test savegame: 0.30_very_easy_start.sav
================================================== warnings summary ===================================================
singularity\code\i18n.py:59
  C:\ESS\MySingularity\singularity\singularity\code\i18n.py:59: DeprecationWarning: 'locale.getdefaultlocale' is deprecated and slated for removal in Python 3.15. Use setlocale(), getencoding() and getlocale() instead.
    language = locale.getdefaultlocale()[0] or default_language

..\..\..\Users\HP\AppData\Local\Programs\Python\Python312\Lib\site-packages\pygame\pkgdata.py:25
  C:\Users\HP\AppData\Local\Programs\Python\Python312\Lib\site-packages\pygame\pkgdata.py:25: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
    from pkg_resources import resource_stream, resource_exists

..\..\..\Users\HP\AppData\Local\Programs\Python\Python312\Lib\site-packages\pkg_resources\__init__.py:3147
..\..\..\Users\HP\AppData\Local\Programs\Python\Python312\Lib\site-packages\pkg_resources\__init__.py:3147
  C:\Users\HP\AppData\Local\Programs\Python\Python312\Lib\site-packages\pkg_resources\__init__.py:3147: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('zope')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=================================================== tests coverage ====================================================
___________________________________ coverage: platform win32, python 3.12.5-final-0 ___________________________________

Name                                     Stmts   Miss  Cover   Missing
----------------------------------------------------------------------
singularity\__init__.py                    238    220     8%   44-45, 55-56, 60, 67-487
singularity\__main__.py                      3      3     0%   23-26
singularity\code\__init__.py                 0      0   100%
singularity\code\base.py                   302    157    48%   99-117, 120-123, 126-129, 132-171, 219, 232-236, 246-262, 275-276, 295-301, 317-325, 365-368, 385, 398-427, 443-446, 449-452, 455-458, 461-472, 475-484, 487-498, 505, 513-516, 524-527, 533, 537-544, 548-562
singularity\code\buyable.py                147     21    86%   95-100, 108, 127, 130-132, 138, 151-152, 168, 172, 205, 240, 256, 260, 266
singularity\code\buyable_before.py         136    136     0%   12-236
singularity\code\chance.py                  18      8    56%   40-44, 55, 63-64, 74
singularity\code\data.py                   378     86    77%   67, 81-88, 91, 94-97, 146-147, 172, 175, 198-199, 211-212, 243-248, 253-259, 295, 299, 303, 319-320, 372-373, 458-459, 466-469, 484-517, 521-537, 568-569, 617-618, 639, 647, 686-695, 700-702
singularity\code\difficulty.py              20      1    95%   32
singularity\code\dirs.py                   103     27    74%   173, 193-212, 235-237, 241, 260-261, 264, 283, 289, 300, 304, 332, 338, 341, 351
singularity\code\effect.py                  53     39    26%   36, 46-102
singularity\code\event.py                   85     42    51%   47, 58-60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 99-103, 106-108, 112-116, 119, 127-147, 150-157
singularity\code\g.py                      219     71    68%   91, 98-109, 115-118, 126-130, 136-140, 147, 151-152, 158-165, 171-172, 178-208, 231-232, 234-235, 244, 260, 279, 316-319, 323-325, 331-332, 414, 418, 422
singularity\code\global_hotkeys.py          80     55    31%   35-42, 45, 48-65, 73-76, 80-88, 92, 96, 100, 104-113, 119-131
singularity\code\graphics\__init__.py        0      0   100%
singularity\code\graphics\button.py        256    182    29%   33-51, 54-57, 62-65, 69, 73-75, 79, 83-85, 88-102, 105-109, 112-119, 122-125, 129-136, 139-147, 150-155, 161-166, 178-188, 191-196, 199-202, 206-210, 213-215, 225-230, 237-239, 244-248, 259-262, 267-268, 273-277, 280-282, 285-287, 290-293, 297-300, 305-307, 312-317, 329-334, 337, 340, 349-353, 357, 361-369, 372-373, 376-377, 387-392, 395-398, 401-402, 405-406, 411-412, 415-416
singularity\code\graphics\constants.py      27      2    93%   44, 47
singularity\code\graphics\dialog.py        457    371    19%   60-72, 76-80, 84-89, 93-96, 100-124, 128-146, 150-151, 174-188, 191-192, 195-197, 200-202, 206-209, 213, 216-219, 222, 225-226, 230-261, 265, 273, 279, 287, 300-409, 414-415, 418, 422-439, 444-449, 452, 455-458, 461-464, 467-469, 472-510, 518, 526-530, 542-549, 558-591, 594-599, 602-607, 614-628, 631-633, 645-681, 684-686, 689-691, 694-696, 703-714, 717, 726, 729-737, 740-741, 748-754, 759, 768-787, 790-792, 795-798, 805-824, 828, 832-838, 841-856
singularity\code\graphics\font.py           63     63     0%   22-137
singularity\code\graphics\g.py              88     57    35%   101-121, 125, 129-145, 156-191, 198-203, 207-209, 215-217, 222, 226-229, 233-236, 240-243, 247-250
singularity\code\graphics\image.py          36     24    33%   29-32, 40-43, 46-57, 60, 63-66, 69-70
singularity\code\graphics\listbox.py       198    159    20%   54-73, 76-84, 87-95, 98, 101-109, 112-117, 120-122, 125-130, 133, 136-150, 153-169, 172-174, 179-192, 195-227, 230-233, 247-256, 259-296, 299-302, 309, 315-316, 324-328, 331-333, 336-347
singularity\code\graphics\scrollbar.py      85     64    25%   30-39, 42-58, 78-107, 118-132, 135-141, 144-147, 150, 153-156, 159, 164-165, 168-169
singularity\code\graphics\slider.py        134    106    21%   29, 59-79, 91-93, 96-98, 101-103, 106, 109-110, 113-142, 145-170, 173, 176-181, 184-193, 196-210, 213-218, 223, 228-229
singularity\code\graphics\text.py          603    493    18%   36-42, 47-49, 53-56, 60-66, 75-111, 116-126, 130-133, 139-183, 187-200, 204-205, 210-212, 258-285, 297, 301, 305-309, 312, 315-317, 320-325, 328-339, 342-373, 377-383, 386-421, 424-432, 435-438, 441-443, 447, 451-472, 476-483, 500-508, 511-513, 516-518, 521-576, 581-648, 651-698, 703, 708-709, 734-740, 743-747, 759-765, 768-773, 778, 783-786, 791, 797-800, 803-823, 831-849, 869-873, 876-884, 889-891, 894-976, 979-992, 995
singularity\code\graphics\theme.py         132    103    22%   34, 38, 43-69, 73-82, 87-91, 94-106, 111-112, 115, 123-139, 144-151, 157, 165-169, 172-188, 191-192, 197-203, 208-212, 215, 218-224, 230-242
singularity\code\graphics\widget.py        379    278    27%   35, 41-42, 48-49, 56, 59-66, 108-120, 145-147, 150-153, 156-157, 180-185, 199-220, 224, 228-247, 250-255, 259-263, 266-269, 276-284, 292, 298-326, 332-336, 339-345, 349-379, 383-407, 410-411, 415-450, 453-504, 508-511, 514, 517, 520-536, 539-541, 545-546, 550-551, 555-556, 560-561, 565-566, 570-571, 575-576, 580-581, 595-599, 602-604, 607-609, 612-623, 626-638, 647-650, 653-655, 658-660, 663-664
singularity\code\group.py                   74     18    76%   80, 88-90, 94, 116, 119, 122, 125, 128-148
singularity\code\hotkey_actions.py          56     56     0%   1-90
singularity\code\i18n.py                   109     17    84%   60-63, 69, 102-103, 165-172, 199-201, 224, 237, 266-267
singularity\code\item.py                   135     67    50%   58-60, 71, 75-76, 94, 134-141, 144-146, 149, 155-194, 213-220, 223-227, 246-279
singularity\code\knowledge.py               24      4    83%   31, 43, 47, 51
singularity\code\location.py               150     32    79%   38, 47, 99, 106, 110, 114, 122, 126, 159-166, 205, 208-212, 215, 218, 242-261
singularity\code\logmessage.py             245     56    77%   82, 86, 90-95, 103, 107, 111, 167-168, 184-187, 191, 195, 199, 203, 220, 228, 232-233, 257-262, 266, 270, 285, 295, 299, 307, 322, 332, 336, 340, 350, 367, 378-385, 389, 393, 397-400, 408, 432-440, 444, 448, 452, 461-469
singularity\code\mixer.py                  125     93    26%   50-53, 58-61, 67-76, 84-130, 137-154, 165-188, 201, 215-222, 229-234, 238, 242-243, 248-258, 263-267, 271
singularity\code\player.py                 519    127    76%   154, 164, 168, 172-173, 250, 252, 299, 308, 323-324, 349-350, 357-358, 362-363, 372-373, 398-402, 406-415, 422-425, 436-437, 441, 453-464, 467-480, 533, 538, 542, 546, 560, 573-574, 581-583, 586-627, 656, 660, 709, 711, 720-726, 744, 754, 759, 765, 787, 795, 819, 824-830, 844-859, 914-920, 923-933, 937-939, 945-954
singularity\code\prerequisite.py            29      5    83%   38-39, 41-42, 77
singularity\code\region.py                  74     23    69%   83, 120-175
singularity\code\safety.py                  51     51     0%   21-119
singularity\code\savegame.py               407    273    33%   138-140, 144, 148, 158, 163, 169, 175-222, 226-234, 238-247, 290-336, 342-349, 377, 383, 387-402, 410-411, 427-487, 497-615, 619-656, 660-675, 679-728, 732-733, 737-738, 742-768, 772-777, 794-824, 834, 873-877
singularity\code\screens\__init__.py         0      0   100%
singularity\code\screens\base.py           298    298     0%   22-670
singularity\code\screens\cheat_menu.py     139    139     0%   20-401
singularity\code\screens\knowledge.py      128    128     0%   21-262
singularity\code\screens\location.py       204    204     0%   21-482
singularity\code\screens\log.py             70     70     0%   21-175
singularity\code\screens\main_menu.py       47     47     0%   21-169
singularity\code\screens\map.py            482    482     0%   22-995
singularity\code\screens\message.py         53     53     0%   22-141
singularity\code\screens\options.py        372    372     0%   21-907
singularity\code\screens\report.py          67     67     0%   21-244
singularity\code\screens\research.py       110    110     0%   21-234
singularity\code\screens\savegame.py       166    166     0%   21-380
singularity\code\screens\stat.py            22     22     0%   21-83
singularity\code\spec.py                    51      2    96%   128-129
singularity\code\stats.py                   53      4    92%   31, 64-67
singularity\code\task.py                    36      4    89%   40, 54-55, 69
singularity\code\tech.py                    49      7    86%   59-62, 66, 73-75
singularity\code\warning.py                 43     22    49%   50, 54, 58, 62, 66-113
----------------------------------------------------------------------
TOTAL                                     8628   5787    33%
=============================================== short test summary info ===============================================
FAILED tests/test_savegames.py::test_savegames - _pickle.UnpicklingError: the STRING opcode argument must be quoted
================================= 1 failed, 31 passed, 1 xpassed, 4 warnings in 8.53s =================================

C:\ESS\MySingularity\singularity>